
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/assisted/plot_b04segmentation.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_assisted_plot_b04segmentation.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_assisted_plot_b04segmentation.py:


Catalog for segmented parameters
================================

Investigate the segmentations of parameters.

We consider 4 specifications for the constants:

    - Not segmented
    - Segmented by GA (yearly subscription to public transport)
    - Segmented by luggage
    - Segmented both by GA and luggage

We consider 3 specifications for the time coefficients:

    - Not Segmented
    - Segmented with first class
    - Segmented with trip purpose

We obtain a total of 12 specifications.
See `Bierlaire and Ortelli (2023)
<https://transp-or.epfl.ch/documents/technicalReports/BierOrte23.pdf>`_.

:author: Michel Bierlaire, EPFL
:date: Thu Jul 13 16:18:10 2023

.. GENERATED FROM PYTHON SOURCE LINES 29-54

.. code-block:: Python


    import numpy as np
    from IPython.core.display_functions import display

    import biogeme.biogeme as bio
    from biogeme import models
    from biogeme.expressions import Beta
    from biogeme.catalog import segmentation_catalogs
    from biogeme.results import compile_estimation_results, pareto_optimal


    from biogeme.data.swissmetro import (
        read_data,
        CHOICE,
        SM_AV,
        CAR_AV_SP,
        TRAIN_AV_SP,
        TRAIN_TT_SCALED,
        TRAIN_COST_SCALED,
        SM_TT_SCALED,
        SM_COST_SCALED,
        CAR_TT_SCALED,
        CAR_CO_SCALED,
    )








.. GENERATED FROM PYTHON SOURCE LINES 55-56

Read the data

.. GENERATED FROM PYTHON SOURCE LINES 56-58

.. code-block:: Python

    database = read_data()








.. GENERATED FROM PYTHON SOURCE LINES 59-60

Definition of the segmentations.

.. GENERATED FROM PYTHON SOURCE LINES 60-73

.. code-block:: Python

    segmentation_ga = database.generate_segmentation(
        variable='GA', mapping={0: 'noGA', 1: 'GA'}
    )

    segmentation_luggage = database.generate_segmentation(
        variable='LUGGAGE', mapping={0: 'no_lugg', 1: 'one_lugg', 3: 'several_lugg'}
    )

    segmentation_first = database.generate_segmentation(
        variable='FIRST', mapping={0: '2nd_class', 1: '1st_class'}
    )









.. GENERATED FROM PYTHON SOURCE LINES 74-76

We consider two trip purposes: 'commuters' and anything else. We
need to define a binary variable first.

.. GENERATED FROM PYTHON SOURCE LINES 76-82

.. code-block:: Python

    database.data['COMMUTERS'] = np.where(database.data['PURPOSE'] == 1, 1, 0)

    segmentation_purpose = database.generate_segmentation(
        variable='COMMUTERS', mapping={0: 'non_commuters', 1: 'commuters'}
    )








.. GENERATED FROM PYTHON SOURCE LINES 83-84

Parameters to be estimated.

.. GENERATED FROM PYTHON SOURCE LINES 84-89

.. code-block:: Python

    ASC_CAR = Beta('ASC_CAR', 0, None, None, 0)
    ASC_TRAIN = Beta('ASC_TRAIN', 0, None, None, 0)
    B_TIME = Beta('B_TIME', 0, None, None, 0)
    B_COST = Beta('B_COST', 0, None, None, 0)








.. GENERATED FROM PYTHON SOURCE LINES 90-91

Catalogs for the alternative specific constants.

.. GENERATED FROM PYTHON SOURCE LINES 91-101

.. code-block:: Python

    ASC_TRAIN_catalog, ASC_CAR_catalog = segmentation_catalogs(
        generic_name='ASC',
        beta_parameters=[ASC_TRAIN, ASC_CAR],
        potential_segmentations=(
            segmentation_ga,
            segmentation_luggage,
        ),
        maximum_number=2,
    )








.. GENERATED FROM PYTHON SOURCE LINES 102-106

Catalog for the travel time coefficient.
Note that the function returns a list of catalogs. Here, the list
contains only one of them.  This is why there is a comma after
"B_TIME_catalog".

.. GENERATED FROM PYTHON SOURCE LINES 106-116

.. code-block:: Python

    (B_TIME_catalog,) = segmentation_catalogs(
        generic_name='B_TIME',
        beta_parameters=[B_TIME],
        potential_segmentations=(
            segmentation_first,
            segmentation_purpose,
        ),
        maximum_number=1,
    )








.. GENERATED FROM PYTHON SOURCE LINES 117-118

Definition of the utility functions.

.. GENERATED FROM PYTHON SOURCE LINES 118-122

.. code-block:: Python

    V1 = ASC_TRAIN_catalog + B_TIME_catalog * TRAIN_TT_SCALED + B_COST * TRAIN_COST_SCALED
    V2 = B_TIME_catalog * SM_TT_SCALED + B_COST * SM_COST_SCALED
    V3 = ASC_CAR_catalog + B_TIME_catalog * CAR_TT_SCALED + B_COST * CAR_CO_SCALED








.. GENERATED FROM PYTHON SOURCE LINES 123-124

Associate utility functions with the numbering of alternatives.

.. GENERATED FROM PYTHON SOURCE LINES 124-126

.. code-block:: Python

    V = {1: V1, 2: V2, 3: V3}








.. GENERATED FROM PYTHON SOURCE LINES 127-128

Associate the availability conditions with the alternatives.

.. GENERATED FROM PYTHON SOURCE LINES 128-130

.. code-block:: Python

    av = {1: TRAIN_AV_SP, 2: SM_AV, 3: CAR_AV_SP}








.. GENERATED FROM PYTHON SOURCE LINES 131-133

Definition of the model. This is the contribution of each
observation to the log likelihood function.

.. GENERATED FROM PYTHON SOURCE LINES 133-135

.. code-block:: Python

    logprob = models.loglogit(V, av, CHOICE)








.. GENERATED FROM PYTHON SOURCE LINES 136-137

Create the Biogeme object.

.. GENERATED FROM PYTHON SOURCE LINES 137-142

.. code-block:: Python

    the_biogeme = bio.BIOGEME(database, logprob)
    the_biogeme.modelName = 'b04segmentation'
    the_biogeme.generate_html = False
    the_biogeme.generate_pickle = False








.. GENERATED FROM PYTHON SOURCE LINES 143-144

Estimate the parameters

.. GENERATED FROM PYTHON SOURCE LINES 144-146

.. code-block:: Python

    dict_of_results = the_biogeme.estimate_catalog()








.. GENERATED FROM PYTHON SOURCE LINES 147-148

Number of estimated models.

.. GENERATED FROM PYTHON SOURCE LINES 148-150

.. code-block:: Python

    print(f'A total of {len(dict_of_results)} models have been estimated')





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    A total of 12 models have been estimated




.. GENERATED FROM PYTHON SOURCE LINES 151-152

All estimation results

.. GENERATED FROM PYTHON SOURCE LINES 152-156

.. code-block:: Python

    compiled_results, specs = compile_estimation_results(
        dict_of_results, use_short_names=True
    )








.. GENERATED FROM PYTHON SOURCE LINES 157-159

.. code-block:: Python

    display(compiled_results)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

                                          Model_000000  ...      Model_000011
    Number of estimated parameters                   5  ...                 7
    Sample size                                  10719  ...             10719
    Final log likelihood                  -8669.931927  ...      -8311.858612
    Akaike Information Criterion          17349.863853  ...      16637.717224
    Bayesian Information Criterion        17386.262719  ...      16688.675636
    ASC_CAR (t-test)                   0.0172  (0.441)  ...   0.0162  (0.394)
    ASC_TRAIN (t-test)                    -0.65  (-11)  ...    -1.12  (-17.3)
    B_COST (t-test)                    -0.789  (-15.5)  ...   -0.702  (-13.3)
    B_TIME (t-test)                     -1.27  (-23.1)  ...    -1.18  (-21.6)
    B_TIME_commuters (t-test)        -0.0604  (-0.292)  ...  -0.168  (-0.784)
    B_TIME_1st_class (t-test)                           ...                  
    ASC_CAR_one_lugg (t-test)                           ...                  
    ASC_CAR_several_lugg (t-test)                       ...                  
    ASC_TRAIN_one_lugg (t-test)                         ...                  
    ASC_TRAIN_several_lugg (t-test)                     ...                  
    ASC_CAR_GA (t-test)                                 ...    -1.26  (-8.17)
    ASC_TRAIN_GA (t-test)                               ...      1.53  (22.3)

    [17 rows x 12 columns]




.. GENERATED FROM PYTHON SOURCE LINES 160-161

Glossary

.. GENERATED FROM PYTHON SOURCE LINES 161-164

.. code-block:: Python

    for short_name, spec in specs.items():
        print(f'{short_name}\t{spec}')





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Model_000000    ASC:no_seg;B_TIME:COMMUTERS
    Model_000001    ASC:no_seg;B_TIME:FIRST
    Model_000002    ASC:LUGGAGE;B_TIME:no_seg
    Model_000003    ASC:GA;B_TIME:no_seg
    Model_000004    ASC:LUGGAGE;B_TIME:FIRST
    Model_000005    ASC:LUGGAGE;B_TIME:COMMUTERS
    Model_000006    ASC:GA-LUGGAGE;B_TIME:FIRST
    Model_000007    ASC:GA-LUGGAGE;B_TIME:no_seg
    Model_000008    ASC:GA;B_TIME:FIRST
    Model_000009    ASC:no_seg;B_TIME:no_seg
    Model_000010    ASC:GA-LUGGAGE;B_TIME:COMMUTERS
    Model_000011    ASC:GA;B_TIME:COMMUTERS




.. GENERATED FROM PYTHON SOURCE LINES 165-166

Estimation results of the Pareto optimal models.

.. GENERATED FROM PYTHON SOURCE LINES 166-171

.. code-block:: Python

    pareto_results = pareto_optimal(dict_of_results)
    compiled_pareto_results, pareto_specs = compile_estimation_results(
        pareto_results, use_short_names=True
    )








.. GENERATED FROM PYTHON SOURCE LINES 172-174

.. code-block:: Python

    display(compiled_pareto_results)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

                                        Model_000000  ...      Model_000004
    Number of estimated parameters                 6  ...                 7
    Sample size                                10719  ...             10719
    Final log likelihood                -8313.612718  ...      -8257.106047
    Akaike Information Criterion        16639.225437  ...      16528.212094
    Bayesian Information Criterion      16682.904076  ...      16579.170506
    ASC_CAR (t-test)                 0.0143  (0.361)  ...  0.00577  (0.145)
    ASC_CAR_GA (t-test)               -1.26  (-8.18)  ...    -1.24  (-7.99)
    ASC_TRAIN (t-test)                -1.12  (-18.2)  ...    -1.17  (-18.4)
    ASC_TRAIN_GA (t-test)               1.52  (22.1)  ...      1.49  (21.7)
    B_COST (t-test)                  -0.704  (-13.3)  ...   -0.783  (-13.4)
    B_TIME (t-test)                   -1.19  (-18.3)  ...   -0.868  (-10.2)
    B_TIME_1st_class (t-test)                         ...   -0.619  (-8.43)
    ASC_CAR_one_lugg (t-test)                         ...                  
    ASC_CAR_several_lugg (t-test)                     ...                  
    ASC_TRAIN_one_lugg (t-test)                       ...                  
    ASC_TRAIN_several_lugg (t-test)                   ...                  

    [16 rows x 5 columns]




.. GENERATED FROM PYTHON SOURCE LINES 175-176

Glossary.

.. GENERATED FROM PYTHON SOURCE LINES 176-178

.. code-block:: Python

    for short_name, spec in pareto_specs.items():
        print(f'{short_name}\t{spec}')




.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Model_000000    ASC:GA;B_TIME:no_seg
    Model_000001    ASC:no_seg;B_TIME:FIRST
    Model_000002    ASC:GA-LUGGAGE;B_TIME:FIRST
    Model_000003    ASC:no_seg;B_TIME:no_seg
    Model_000004    ASC:GA;B_TIME:FIRST





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 4.734 seconds)


.. _sphx_glr_download_auto_examples_assisted_plot_b04segmentation.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_b04segmentation.ipynb <plot_b04segmentation.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_b04segmentation.py <plot_b04segmentation.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_b04segmentation.zip <plot_b04segmentation.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
